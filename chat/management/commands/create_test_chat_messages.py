from django.core.management.base import BaseCommand
from django.contrib.auth import get_user_model
from chat.models import Room, Message
from django.utils import timezone
import random

User = get_user_model()

class Command(BaseCommand):
    help = '–°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–∞—Ö –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏'

    def add_arguments(self, parser):
        parser.add_argument(
            '--clear',
            action='store_true',
            help='–û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö',
        )

    def handle(self, *args, **options):
        if options['clear']:
            Message.objects.all().delete()
            self.stdout.write('üßπ –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—á–∏—â–µ–Ω—ã')

        # –°–æ–∑–¥–∞–µ–º –∫–æ–º–Ω–∞—Ç—ã –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
        general_room, _ = Room.objects.get_or_create(name='general')
        vip_room, _ = Room.objects.get_or_create(name='vip')

        # –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ–±—â–µ–≥–æ —á–∞—Ç–∞
        general_messages = [
            ("owner", "üëë –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à—É –ë–µ—Å–µ–¥–∫—É! –ó–¥–µ—Å—å –º—ã –æ–±—Å—É–∂–¥–∞–µ–º –≤—Å–µ —á—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ä–∞—Å—Ç–µ–Ω–∏–µ–≤–æ–¥—Å—Ç–≤–æ–º."),
            ("user_test1", "–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º! –ù–æ–≤–∏—á–æ–∫ —Ç—É—Ç, –ø–æ–¥—Å–∫–∞–∂–∏—Ç–µ —Å —á–µ–≥–æ –ª—É—á—à–µ –Ω–∞—á–∞—Ç—å?"),
            ("moderator", "üõ°Ô∏è @user_test1 –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –†–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–∞—á–∞—Ç—å —Å –∏–∑—É—á–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ '–ù–æ–≤–æ—Å—Ç–∏' - —Ç–∞–º –º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏."),
            ("store_admin", "üì¶ –ö—Å—Ç–∞—Ç–∏, —É –Ω–∞—Å –µ—Å—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ –≤ –º–∞–≥–∞–∑–∏–Ω–µ. –û—á–µ–Ω—å —É–¥–æ–±–Ω–æ!"),
            ("user_test2", "–ê —è —É–∂–µ —Ç—Ä–µ—Ç–∏–π –≥–æ–¥ –≤—ã—Ä–∞—â–∏–≤–∞—é —Ç–æ–º–∞—Ç—ã. –ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã - —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ!"),
            ("store_owner", "üè™ –°–∫–æ—Ä–æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ—Ä—Ç–æ–≤ —Å–µ–º—è–Ω. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏!"),
            ("user_test1", "–°–ø–∞—Å–∏–±–æ –∑–∞ —Ç–µ–ø–ª—ã–π –ø—Ä–∏–µ–º! –û—á–µ–Ω—å —Ä–∞–¥ –±—ã—Ç—å —á–∞—Å—Ç—å—é —Å–æ–æ–±—â–µ—Å—Ç–≤–∞."),
            ("moderator", "üõ°Ô∏è –ù–∞–ø–æ–º–∏–Ω–∞—é –≤—Å–µ–º –æ –ø—Ä–∞–≤–∏–ª–∞—Ö —á–∞—Ç–∞ - –±—É–¥—å—Ç–µ –≤–µ–∂–ª–∏–≤—ã –∏ –ø–æ–º–æ–≥–∞–π—Ç–µ –¥—Ä—É–≥ –¥—Ä—É–≥—É!"),
        ]

        # –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è VIP —á–∞—Ç–∞
        vip_messages = [
            ("owner", "üëë VIP —á–∞—Ç –¥–ª—è –æ—Å–æ–±—ã—Ö –æ–±—Å—É–∂–¥–µ–Ω–∏–π –∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏."),
            ("moderator", "üõ°Ô∏è –ó–¥–µ—Å—å –º—ã –º–æ–∂–µ–º –æ–±—Å—É–∂–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∞–π—Ç–∞ –∏ –¥–µ–ª–∏—Ç—å—Å—è –∏–Ω—Å–∞–π–¥–µ—Ä—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π."),
            ("store_owner", "üè™ –ü–ª–∞–Ω–∏—Ä—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è VIP —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤."),
            ("owner", "üëë –û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è! –¢–∞–∫–∂–µ –¥—É–º–∞—é –Ω–∞–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–∫—Ä—ã—Ç—ã—Ö –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–æ–≤."),
            ("moderator", "üõ°Ô∏è –ü—Ä–µ–¥–ª–∞–≥–∞—é –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ Q&A —Å–µ—Å—Å–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è VIP —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤."),
        ]

        # –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–±—â–µ–º —á–∞—Ç–µ
        for i, (username, text) in enumerate(general_messages):
            try:
                user = User.objects.get(username=username)
                Message.objects.create(
                    room=general_room,
                    author=user,
                    content=text,
                    created_at=timezone.now() - timezone.timedelta(minutes=len(general_messages)-i)
                )
            except User.DoesNotExist:
                self.stdout.write(f'‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {username} –Ω–µ –Ω–∞–π–¥–µ–Ω')

        # –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ VIP —á–∞—Ç–µ
        for i, (username, text) in enumerate(vip_messages):
            try:
                user = User.objects.get(username=username)
                Message.objects.create(
                    room=vip_room,
                    author=user,
                    content=text,
                    created_at=timezone.now() - timezone.timedelta(minutes=len(vip_messages)-i)
                )
            except User.DoesNotExist:
                self.stdout.write(f'‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {username} –Ω–µ –Ω–∞–π–¥–µ–Ω')

        self.stdout.write('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!')
        self.stdout.write(f'üìä –û–±—â–∏–π —á–∞—Ç: {len(general_messages)} —Å–æ–æ–±—â–µ–Ω–∏–π')
        self.stdout.write(f'üëë VIP —á–∞—Ç: {len(vip_messages)} —Å–æ–æ–±—â–µ–Ω–∏–π')
        self.stdout.write('üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ --clear –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º')
