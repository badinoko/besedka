# üöë –ü–ª–∞–Ω —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ Rocket.Chat –∏ MongoDB

**–í–µ—Ä—Å–∏—è:** 1.0  ‚Ä¢  –î–∞—Ç–∞: 21 –∏—é–Ω—è 2025 –≥.

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –ø–æ—à–∞–≥–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç, –∏—Å–∫–ª—é—á–∞—é—â–∏–π –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ—è–≤–ª–µ–Ω–∏—è Setup Wizard, –ø—Ä–æ–ø–∞–∂—É –∫–∞–Ω–∞–ª–æ–≤ –∏ ¬´–¥–≤–æ–π–Ω—É—é Mongo¬ª. –°–ª–µ–¥—É—è –µ–º—É, –≤—ã –Ω–∞–∫–æ–Ω–µ—Ü –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É Rocket.Chat –ø–æ 30 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥.

---

## 1. –ì–¥–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–µ–∂–∞—Ç –¥–∞–Ω–Ω—ã–µ
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–∞–Ω–∞–ª—ã, OAuth-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è Rocket.Chat —Ö—Ä–∞–Ω—è—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –≤ MongoDB (`/data/db`).
- –ï—Å–ª–∏ —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Mongo –Ω–µ—Ç **–∏–º–µ–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ** volume, –¥–∞–Ω–Ω—ã–µ –ø–∏—à—É—Ç—Å—è –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–ª–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –µ–≥–æ —É–¥–∞–ª–µ–Ω–∏–∏.

## 2. –ü–æ—á–µ–º—É –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ¬´–¥–≤–µ Mongo¬ª
1. –í —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º compose-—Ñ–∞–π–ª–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å–µ—Ä–≤–∏—Å—ã `mongo` –∏ `mongo-init-replica`.
2. `mongo-init-replica` –Ω—É–∂–µ–Ω **–æ–¥–∏–Ω —Ä–∞–∑** ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–ª–∏–∫–∞-—Å–µ—Ç `rs0`.
3. –ï—Å–ª–∏ –µ–≥–æ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å, –ø–æ–ª—É—á–∏—Ç—Å—è –¥–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ `mongod`, –æ–±–∞ —Å–ª—É—à–∞—é—Ç `27017`. –í –≥–æ–Ω–∫–µ –∑–∞ –ø–æ—Ä—Ç–æ–º –±–∞–∑–∞ –ø–æ–≤—Ä–µ–∂–¥–∞–µ—Ç—Å—è –∏–ª–∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è ¬´–Ω–µ —Ç–∞¬ª Mongo.

## 3. –ü–æ—á–µ–º—É –±–∞–∑–∞ ¬´–æ–±–Ω—É–ª—è–µ—Ç—Å—è¬ª
- –ó–∞–ø—É—Å–∫ `docker-compose down -v` —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç volume ‚Üí –Ω–æ–≤–∞—è —á–∏—Å—Ç–∞—è Mongo.
- Docker Desktop –¥–ª—è Windows —É–¥–∞–ª—è–µ—Ç ¬´anonymous volumes¬ª, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –Ω–∞–∑–≤–∞–Ω—ã –≤ `volumes:`.
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç –¥–≤—É—Ö `mongod` –ø–æ–≤—Ä–µ–∂–¥–∞–µ—Ç `oplog`; –ø–æ—Å–ª–µ –∫—Ä–∞—à–∞ Rocket.Chat –≤–∏–¥–∏—Ç –ø—É—Å—Ç—É—é –ë–î –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç Setup Wizard.

## 4. –®–∞–≥–∏ –∫ —É—Å—Ç–æ–π—á–∏–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –®–∞–≥ 1. –û–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Mongo + named volume
```yaml
db:
  image: mongo:6.0
  command: ["mongod", "--replSet", "rs0", "--bind_ip_all"]
  restart: unless-stopped
  volumes:
    - rocketchat-mongo:/data/db
volumes:
  rocketchat-mongo:
```

### –®–∞–≥ 2. –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–ª–∏–∫–∏
```bash
# –≤—ã–ø–æ–ª–Ω–∏—Ç—å –µ–¥–∏–Ω–æ–∂–¥—ã
docker exec -it <mongo_container> mongosh --eval 'rs.initiate({_id:"rs0",members:[{_id:0,host:"db:27017"}]})'
```

### –®–∞–≥ 3. –ñ—ë—Å—Ç–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python
 taskkill /f /im python.exe
# 2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–∞—Ç –∏ Mongo
 docker-compose -f docker-compose.local.yml stop rocketchat db
# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å Mongo –∏ –¥–æ–∂–¥–∞—Ç—å—Å—è PRIMARY
 docker-compose -f docker-compose.local.yml up -d db
 docker logs -f db   # —É–±–µ–¥–∏—Ç—å—Å—è –≤ "PRIMARY rs0"
# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å Rocket.Chat
 docker-compose -f docker-compose.local.yml up -d rocketchat
# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å Django (—Ç–æ–ª—å–∫–æ Daphne)
 daphne -b 127.0.0.1 -p 8001 config.asgi:application
```

### –®–∞–≥ 4. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è—Ç—å volume
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker-compose down` (–±–µ–∑ `-v`). Volume `rocketchat-mongo` —Å–æ—Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏.

### –®–∞–≥ 5. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å URI –≤–æ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö
- `MONGO_URL`: `mongodb://db:27017/rocketchat?replicaSet=rs0`
- –°–∫—Ä–∏–ø—Ç—ã `pymongo` –æ–±—è–∑–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–µ–º –∂–µ URI.

## 5. –ò—Ç–æ–≥: –æ–¥–∏–Ω —Ä–µ—Ü–µ–ø—Ç ‚Äî –∏ –Ω–∏–∫–∞–∫–∏—Ö Setup Wizard
1. **–û–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Mongo.**
2. **–ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π volume.**
3. **Rocket.Chat —Å—Ç–∞—Ä—Ç—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PRIMARY.**
4. **–ù–∏ –æ–¥–Ω–æ–≥–æ `down -v` –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.**
5. **–°–æ–≤–ø–∞–¥–∞—é—â–∏–µ —Ä–µ–ø–ª–∏–∫–∞-—Å–µ—Ç—ã –≤–æ –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.**

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —ç—Ç–∏—Ö –ø—è—Ç–∏ –ø—É–Ω–∫—Ç–æ–≤ –±–∞–∑–∞ –Ω–µ –±—É–¥–µ—Ç –æ–±–Ω—É–ª—è—Ç—å—Å—è, –∫–∞–Ω–∞–ª—ã –∏ —Ä–æ–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è, –∞ Setup Wizard –Ω–∞–≤—Å–µ–≥–¥–∞ –∏—Å—á–µ–∑–Ω–µ—Ç –∏–∑ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞. 
