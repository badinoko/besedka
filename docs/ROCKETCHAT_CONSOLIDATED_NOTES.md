# üìö –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ Rocket.Chat –∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ

> –û–±–Ω–æ–≤–ª–µ–Ω–æ: 19 –∏—é–Ω—è 2025

---

## üöÄ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ (–í–°–ï–ì–î–ê —Å–ª–µ–¥—É–µ–º –∏–º–µ–Ω–Ω–æ —Ç–∞–∫)

1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ Python-–ø—Ä–æ—Ü–µ—Å—Å—ã:
   ```bash
   taskkill /f /im python.exe
   ```
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (*web-1 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –£–ë–ò–¢ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º!*):
   ```bash
   docker-compose -f docker-compose.local.yml stop web   # –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ web-1 –Ω–µ –¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ä—ã–π –∫–æ–¥
   docker-compose -f docker-compose.local.yml up -d      # –∑–∞–ø—É—Å–∫–∞–µ–º postgres, redis, mongo, rocketchat, web –∏ –ø—Ä.
   docker ps | cat                                       # –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–∞–±–æ—Ç–∞—é—Ç postgres, redis, mongo, rocketchat
   ```
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å Django –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ Daphne:
   ```bash
   daphne -b 127.0.0.1 -p 8001 config.asgi:application
   ```
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∫–æ–¥–æ–º **200**:
   ```bash
   curl -s -o /dev/null -w "%{http_code}" http://127.0.0.1:8001/  # ‚Üê –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 200
   ```

---

## üê≥ –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Docker

| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä        | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ           | –ü–æ—Ä—Ç |
|------------------|----------------------|------|
| postgres         | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Django   | 5432 |
| redis            | –ö—ç—à / Celery broker  | 6379 |
| mongo            | –ë–∞–∑–∞ Rocket.Chat     | 27017|
| rocketchat       | –°–∞–º Rocket.Chat      | 3000 |
| web-1            | üî• **–ù–ï –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω** –≤–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏ (–∫–æ–Ω—Ñ–ª–∏–∫—Ç –∫–æ–¥–∞) |

> –ï—Å–ª–∏ `web-1` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è, **—Å—Ä–∞–∑—É** –≤—ã–ø–æ–ª–Ω–∏—Ç—å `docker-compose -f docker-compose.local.yml stop web`.

---

## üåê –ë–∞–∑–æ–≤—ã–µ URL –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –°–µ—Ä–≤–∏—Å                | URL                                    |
|-----------------------|----------------------------------------|
| Django-—Å–∞–π—Ç           | http://127.0.0.1:8001/                 |
| Rocket.Chat UI        | http://127.0.0.1:3000/                 |
| Rocket.Chat iframe    | –≤—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö Django       |
| –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç    | http://127.0.0.1:8001/chat/test/        |
| –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —á–∞—Ç   | http://127.0.0.1:8001/chat/ (—Å—Ç–∞—Ä—ã–π)   |

---

## üîë –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

| –†–æ–ª—å / —Å–µ—Ä–≤–∏—Å         | –õ–æ–≥–∏–Ω              | –ü–∞—Ä–æ–ª—å               |
|-----------------------|--------------------|----------------------|
| Django Owner          | `owner`            | `owner123secure`     |
| Django Moderator      | `admin`            | `admin123secure`     |
| Django Store Owner    | `store_owner`      | `storeowner123secure`|
| Django Store Admin    | `store_admin`      | `storeadmin123secure`|
| Django Test User      | `test_user`        | `user123secure`      |
| Rocket.Chat Admin     | `owner`            | `owner123secure`     |

> **–ù–∏–∫–æ–≥–¥–∞** –Ω–µ —Å–æ–∑–¥–∞—ë–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∫–ª—é—á–µ–≤—ã—Ö —Ä–æ–ª–µ–π. –î–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º `temp_*`.

---

## üîê OAuth ¬´Besedka¬ª (Custom provider –≤ Rocket.Chat)

| –ü–∞—Ä–∞–º–µ—Ç—Ä              | –ó–Ω–∞—á–µ–Ω–∏–µ                                               |
|-----------------------|--------------------------------------------------------|
| Unique Name           | `besedka`                                              |
| URL                   | `http://127.0.0.1:8001`                                |
| Client ID             | `BesedkaRocketChat2025`                                |
| Client Secret         | `SecureSecretKey2025BesedkaRocketChatSSO`              |
| Authorize Path        | `/o/authorize/`                                        |
| Token Path            | `/o/token/`                                            |
| Identity Path         | `/api/v1/auth/rocket/`                                 |
| Scope                 | `read`                                                 |
| Param name token      | `access_token`                                         |
| Login Style           | `redirect`                                             |
| Button label          | ¬´–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –ë–µ—Å–µ–¥–∫—É¬ª                                  |
| Merge users           | `true`                                                 |
| Show button           | `true`                                                 |

### –†–æ–ª–∏ ‚Üí –≥—Ä—É–ø–ø—ã (JSON –¥–ª—è –ø–æ–ª—è mapping)
```json
{
  "owner": "admin,vip",
  "moderator": "admin",
  "user": "user"
}
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Rocket.Chat, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è iframe/SSO

1. Administration ‚Üí Settings ‚Üí General ‚Üí `Restrict access inside any Iframe` ‚Üí **False**
2. Accounts ‚Üí `Require password confirmation` ‚Üí **Disabled**
3. Accounts ‚Üí Two Factor Authentication ‚Üí **Disabled** (TOTP off)
4. OAuth provider ¬´Besedka¬ª ‚Üí `Enable` = **On**

> –ë–µ–∑ –ø—É–Ω–∫—Ç–∞ 1 —á–∞—Ç –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –≤–æ –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π iframe –Ω–∞ —Å–∞–π—Ç–µ.

---

## üìà –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (19 –∏—é–Ω—è 2025)

- Rocket.Chat —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞–∫–∫–∞—É–Ω—Ç `owner` –∞–∫—Ç–∏–≤–µ–Ω.
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä OAuth ¬´Besedka¬ª —Å–æ–∑–¥–∞–Ω, –Ω–æ –ø–æ–ª—è URL/paths **–ø–æ–∫–∞ –ø—É—Å—Ç—ã–µ** ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü–µ–π –≤—ã—à–µ.
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/chat/rocketchat_integrated.html` —Ä–∞–Ω–µ–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ —Ç—Ä–∏ –∫–∞–Ω–∞–ª–∞ –≤ iframe; —Å–µ–π—á–∞—Å –≤—ã–≤–æ–¥–∏—Ç —á–∏—Å—Ç—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, —Ç.–∫. —à–∞–±–ª–æ–Ω –±—ã–ª —É–¥–∞–ª—ë–Ω –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ.
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ Rocket.Chat (—á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π UI) —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º.
- –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π iframe-–≤–∏–¥ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Django –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å SSO.

---

## üìå –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –ø–æ–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ ¬´Besedka¬ª –≤ Rocket.Chat –∫–∞–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ OAuth.
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É–Ω–∫—Ç *Restrict access inside any Iframe* = False.
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å **—Ç–æ–ª—å–∫–æ** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `rocketchat` (–µ—Å–ª–∏ –º–µ–Ω—è–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ UI, –Ω–µ –Ω—É–∂–µ–Ω –ø–æ–ª–Ω—ã–π down/up).
4. –ù–∞ Django-—Å—Ç–æ—Ä–æ–Ω–µ –æ—Ç–∫—Ä—ã—Ç—å `/chat/test/` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ SSO –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–±–µ–∑ –∫–Ω–æ–ø–∫–∏).
5. –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –≤–µ—Ä–Ω—É—Ç—å (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å) —à–∞–±–ª–æ–Ω `rocketchat_integrated.html` –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É ¬´–ß–∞—Ç¬ª —Å–∞–π—Ç–∞.

---

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ë—ã—Å—Ç—Ä—ã–π —Ä–µ—Å—Ç–∞—Ä—Ç —Ç–æ–ª—å–∫–æ rocketchat –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose -f docker-compose.local.yml restart rocketchat

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ Rocket.Chat
docker-compose -f docker-compose.local.yml logs -f --tail=100 rocketchat | cat

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
curl -I http://127.0.0.1:8001 | cat     # Django
curl -I http://127.0.0.1:3000 | cat     # Rocket.Chat
```

---

## üîÑ –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–π –ü–ª–∞–Ω –∏ –ü—Ä–æ–≥—Ä–µ—Å—Å

- **–ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏:** `docs/ROCKETCHAT_MIGRATION_PLAN_V3.md` (–ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- **–ñ—É—Ä–Ω–∞–ª –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:** `docs/ROCKETCHAT_MIGRATION_PROGRESS.md`

> –í—Å–µ –Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä—É–µ–º **—Ç–æ–ª—å–∫–æ** –≤ —ç—Ç–∏—Ö –¥–≤—É—Ö —Ñ–∞–π–ª–∞—Ö, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ö–∞–æ—Å–∞.

---

## üìù –ò—Å—Ç–æ—á–Ω–∏–∫ —Å–≤–µ–¥–µ–Ω–∏–π

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ–±—Ä–∞–Ω–∞ –∏–∑:
- `BESEDKA_MASTER_DOCUMENTATION.md`
- `BESEDKA_UI_STANDARDS.md`
- `BESEDKA_USER_SYSTEM.md`
- `CHANGELOG.md`
- `docs/ROCKETCHAT_*.md`

---

> **–í–∞–∂–Ω–æ:** –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–ª—É–∂–∏—Ç –ª–∏—á–Ω—ã–º ¬´—à–ø–∞—Ä–≥–∞–ª–∫–æ–π¬ª –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –î–µ—Ä–∂–∏—Ç–µ –µ–≥–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º, –Ω–æ –∏–∑–±–µ–≥–∞–π—Ç–µ –∏–∑–ª–∏—à–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π ‚Äî —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, –ª–æ–≥–∏–Ω—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. 
