{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}üì∞ –ù–æ–≤–æ—Å—Ç–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞{% endblock %}

{% block extra_css %}
<!-- AOS Animation -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<!-- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ hero-–∫–Ω–æ–ø–∫–∏ -->
<link rel="stylesheet" href="{% static 'css/unified_hero_buttons.css' %}?v=20250608">
<!-- –ú–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ –¥–ª—è JavaScript -->
<meta name="user-authenticated" content="{% if user.is_authenticated %}true{% else %}false{% endif %}">
<meta name="csrf-token" content="{{ csrf_token }}">
<style>
    /* –£–ù–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–ê–Ø HERO-–°–ï–ö–¶–ò–Ø –í –°–¢–ò–õ–ï –ì–ê–õ–ï–†–ï–ò –ò –ì–†–û–£–†–ï–ü–û–†–¢–û–í */
    :root {
        --news-primary: #007bff;
        --news-secondary: #0056b3;
        --news-accent: #4dabf7;
        --news-success: #339af0;
        --news-warning: #FFC107;
        --news-dark: #2d3748;
        --news-light: #f7fafc;
        --news-glass: rgba(255, 255, 255, 0.1);
        --news-glass-border: rgba(255, 255, 255, 0.2);
        --news-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        --news-shadow-hover: 0 15px 35px rgba(31, 38, 135, 0.5);
        --news-border-radius: 16px;
        --news-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    .news-page {
        background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%);
        min-height: 100vh;
        padding: 20px 0;
    }

    /* –ì–ï–†–û–ô –°–ï–ö–¶–ò–Ø */
    .news-hero {
        background: linear-gradient(135deg, var(--news-primary) 0%, var(--news-secondary) 100%);
        color: white;
        padding: 1.5rem 0;
        margin-bottom: 2rem;
        border-radius: 1rem;
        position: relative;
        overflow: hidden;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
    }

    .news-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.3;
    }

    .hero-content {
        position: relative;
        z-index: 2;
    }

    .hero-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    .hero-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-bottom: 1rem;
        font-weight: 300;
    }

    .hero-stats {
        display: flex;
        gap: 0.75rem;
        margin-top: 0.75rem;
        flex-wrap: wrap;
        justify-content: center;
    }

    .stat-item {
        text-align: center;
        background: var(--news-glass);
        backdrop-filter: blur(10px);
        border: 1px solid var(--news-glass-border);
        border-radius: var(--news-border-radius);
        padding: 0.6rem 0.8rem;
        min-width: 100px;
        width: auto;
        max-width: 140px;
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .stat-number {
        display: block;
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--news-accent);
        line-height: 1;
        margin-bottom: 0.3rem;
        word-break: break-all;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª */
    .stat-number:has-text([0-9]{5,}) {
        font-size: 1.1rem;
    }

    .stat-label {
        font-size: 0.7rem;
        opacity: 0.8;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        line-height: 1.2;
        word-break: break-word;
    }

    .hero-actions {
        position: relative;
        z-index: 2;
    }

    .hero-btn {
        background: linear-gradient(135deg, #FFC107 0%, #FF8F00 100%);
        border: 2px solid #FFC107;
        color: #ffffff !important;
        font-weight: 700;
        padding: 15px 30px;
        border-radius: 12px;
        transition: var(--news-transition);
        text-decoration: none !important;
        font-size: 1.1rem;
        box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        letter-spacing: 0.5px;
        display: inline-block;
    }

    .hero-btn:hover {
        background: linear-gradient(135deg, #FF8F00 0%, #E65100 100%);
        border-color: #FF8F00;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(255, 143, 0, 0.5);
        color: #ffffff !important;
        text-decoration: none !important;
    }

    /* –°–û–í–†–ï–ú–ï–ù–ù–´–ï –§–ò–õ–¨–¢–†–´ */
    .news-filters {
        background: var(--news-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--news-glass-border);
        border-radius: var(--news-border-radius);
        padding: 0.75rem;
        margin-bottom: 2rem;
        box-shadow: var(--news-shadow);
    }

    .filter-tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
        justify-content: center;
    }

    .filter-tab {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 1.5rem;
        color: var(--news-dark);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.9rem;
        transition: var(--news-transition);
        backdrop-filter: blur(10px);
        cursor: pointer;
    }

    .filter-tab:hover {
        background: rgba(0, 123, 255, 0.2);
        border-color: var(--news-primary);
        color: var(--news-primary);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
    }

    .filter-tab.active {
        background: linear-gradient(135deg, var(--news-primary), var(--news-secondary));
        border-color: var(--news-primary);
        color: white;
        box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
    }

    .news-card {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        border: none;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        background: white;
        min-height: 420px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É */
    }

    .news-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .news-image {
        height: 220px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
        object-fit: cover;
        width: 100%;
        transition: transform 0.3s ease;
    }

    .news-card:hover .news-image {
        transform: scale(1.05);
    }

    .news-meta {
        font-size: 0.875rem;
        color: #6c757d;
    }

    .news-excerpt {
        color: #495057;
        line-height: 1.6;
        font-size: 0.95rem;
    }

    .category-badge {
        font-size: 0.75rem;
        padding: 0.35rem 0.75rem;
        border-radius: 25px;
        font-weight: 500;
        letter-spacing: 0.5px;
    }

    .pinned-post {
        border-left: 4px solid #ffc107;
        background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
        box-shadow: 0 4px 15px rgba(255, 193, 7, 0.2);
    }

    .poll-card {
        border-left: 4px solid #17a2b8;
        background: linear-gradient(135deg, #e6f7ff 0%, #ffffff 100%);
        box-shadow: 0 4px 15px rgba(23, 162, 184, 0.2);
    }

    .video-card {
        border-left: 4px solid #dc3545;
        background: linear-gradient(135deg, #ffe6e6 0%, #ffffff 100%);
        box-shadow: 0 4px 15px rgba(220, 53, 69, 0.2);
    }

    .sidebar-widget {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border: 1px solid #e9ecef;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .search-form {
        position: relative;
    }

    .search-form .form-control {
        padding-right: 3rem;
        border-radius: 25px;
        border: 2px solid #e9ecef;
        transition: border-color 0.3s ease;
        padding: 0.75rem 1rem;
    }

    .search-form .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
    }

    .search-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        background: #007bff;
        border: none;
        border-radius: 50%;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .search-btn:hover {
        background: #0056b3;
    }

    .category-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .category-list li {
        margin-bottom: 0.75rem;
    }

    .category-list a {
        display: flex;
        justify-content: between;
        align-items: center;
        padding: 0.75rem;
        background: white;
        border-radius: 10px;
        text-decoration: none;
        color: #495057;
        transition: all 0.3s ease;
        border: 1px solid #e9ecef;
    }

    .category-list a:hover {
        background: #007bff;
        color: white;
        transform: translateX(5px);
    }

    .category-list .badge {
        margin-left: auto;
    }

    .post-stats {
        display: flex;
        gap: 1rem;
        align-items: center;
        font-size: 0.875rem;
        color: #6c757d;
    }

    .post-stats i {
        margin-right: 0.25rem;
        color: #007bff;
    }

    .post-stats span {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ç–µ–≥–∏ */
    .tag-badge {
        background: #e3f2fd;
        color: #1976d2;
        border: 1px solid #bbdefb;
        transition: all 0.3s ease;
    }

    .tag-badge:hover {
        background: #1976d2;
        color: white;
        transform: translateY(-1px);
    }

    /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è */
    .pagination .page-link {
        border-radius: 8px;
        margin: 0 2px;
        border: 1px solid #dee2e6;
        color: #007bff;
    }

    .pagination .page-item.active .page-link {
        background: #007bff;
        border-color: #007bff;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ */
    .news-card {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.6s ease forwards;
    }

    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* –ó–∞–¥–µ—Ä–∂–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ */
    .news-card:nth-child(1) { animation-delay: 0.1s; }
    .news-card:nth-child(2) { animation-delay: 0.2s; }
    .news-card:nth-child(3) { animation-delay: 0.3s; }
    .news-card:nth-child(4) { animation-delay: 0.4s; }
    .news-card:nth-child(5) { animation-delay: 0.5s; }
    .news-card:nth-child(6) { animation-delay: 0.6s; }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    .card-title a {
        font-weight: 600;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        transition: color 0.3s ease;
    }

    .card-title a:hover {
        color: #007bff !important;
    }

    /* –ö–Ω–æ–ø–∫–∞ "–ß–∏—Ç–∞—Ç—å" */
    .btn-read-more {
        border-radius: 20px;
        padding: 0.4rem 1rem;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.3s ease;
        border: 2px solid #007bff;
    }

    .btn-read-more:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0,123,255,0.3);
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å */
    .card-divider {
        border: none;
        height: 1px;
        background: linear-gradient(90deg, transparent, #dee2e6, transparent);
        margin: 1rem 0;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
    .post-stats span {
        background: #f8f9fa;
        padding: 0.25rem 0.5rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .post-stats span:hover {
        background: #e9ecef;
        transform: translateY(-1px);
    }

    /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ—Ä–µ */
    .author-info {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
        color: #6c757d;
        border: 1px solid #e9ecef;
    }
</style>
{% endblock %}

{% block content %}
<div class="news-page">
    <div class="hero-container">
        <div class="container">
            <!-- –ì–ï–†–û–ô –°–ï–ö–¶–ò–Ø –° –ü–†–ê–í–ò–õ–¨–ù–û–ô –°–¢–ê–¢–ò–°–¢–ò–ö–û–ô -->
            <div class="news-hero" data-aos="fade-up" data-aos-duration="600">
            <div class="container">
                <div class="hero-content text-center">
                    <h1 class="hero-title">üì∞ –ù–æ–≤–æ—Å—Ç–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</h1>
                    <p class="hero-subtitle">–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π –∏ —Ç—Ä–µ–Ω–¥–æ–≤ –º–∏—Ä–∞ —Ä–∞—Å—Ç–µ–Ω–∏–µ–≤–æ–¥—Å—Ç–≤–∞</p>

                    <div class="hero-stats">
                        <div class="stat-item" data-aos="zoom-in" data-aos-delay="100">
                            <span class="stat-number">{{ total_posts }}</span>
                            <span class="stat-label">–ù–æ–≤–æ—Å—Ç–µ–π</span>
                        </div>
                        <div class="stat-item" data-aos="zoom-in" data-aos-delay="200">
                            <span class="stat-number">{{ total_categories }}</span>
                            <span class="stat-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–π</span>
                        </div>
                        <div class="stat-item" data-aos="zoom-in" data-aos-delay="300">
                            <span class="stat-number">{{ total_views }}</span>
                            <span class="stat-label">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- –°–û–í–†–ï–ú–ï–ù–ù–´–ï –§–ò–õ–¨–¢–†–´ –° AJAX -->
        <div class="news-filters" data-aos="fade-up">
            <div class="filter-tabs">
                <button class="filter-tab {% if current_filter == 'all' or not current_filter %}active{% endif %}" data-filter="all">
                    <i class="fas fa-list"></i>
                    –í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏
                </button>
                <button class="filter-tab {% if current_filter == 'articles' %}active{% endif %}" data-filter="articles">
                    <i class="fas fa-file-alt"></i>
                    –°—Ç–∞—Ç—å–∏
                </button>
                <button class="filter-tab {% if current_filter == 'polls' %}active{% endif %}" data-filter="polls">
                    <i class="fas fa-poll"></i>
                    –û–ø—Ä–æ—Å—ã
                </button>
                <button class="filter-tab {% if current_filter == 'videos' %}active{% endif %}" data-filter="videos">
                    <i class="fas fa-video"></i>
                    –í–∏–¥–µ–æ
                </button>
                <button class="filter-tab {% if current_filter == 'pinned' %}active{% endif %}" data-filter="pinned">
                    <i class="fas fa-thumbtack"></i>
                    –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ
                </button>
            </div>
        </div>

    <div class="row">
        <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
        <div class="col-lg-8">
            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è AJAX –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
            <div id="news-content">
                {% include 'news/partials/news_cards.html' %}
            </div>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è AJAX –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
            <div id="news-pagination">
                {% if is_paginated %}
                <nav aria-label="–ü–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π" data-aos="fade-up">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link pagination-link" href="javascript:void(0)" data-page="1" data-filter="{{ current_filter }}">–ü–µ—Ä–≤–∞—è</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link pagination-link" href="javascript:void(0)" data-page="{{ page_obj.previous_page_number }}" data-filter="{{ current_filter }}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
                            </li>
                        {% endif %}

                        <li class="page-item active">
                            <span class="page-link">{{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>
                        </li>

                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link pagination-link" href="javascript:void(0)" data-page="{{ page_obj.next_page_number }}" data-filter="{{ current_filter }}">–°–ª–µ–¥—É—é—â–∞—è</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link pagination-link" href="javascript:void(0)" data-page="{{ page_obj.paginator.num_pages }}" data-filter="{{ current_filter }}">–ü–æ—Å–ª–µ–¥–Ω—è—è</a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            </div>
        </div>

    <!-- –°–ê–ô–î–ë–ê–† -->
    <div class="col-lg-4">
        <!-- –ü–û–ò–°–ö -->
        <div class="sidebar-widget">
            <h5 class="mb-3">
                <i class="fas fa-search text-primary me-2"></i>
                –ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π
            </h5>
            <form method="get" action="{% url 'news:search' %}" class="search-form">
                <input type="text" name="q" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞..." value="{{ request.GET.q }}">
                <button type="submit" class="search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </form>
        </div>

        <!-- –ö–ê–¢–ï–ì–û–†–ò–ò -->
        {% if categories %}
        <div class="sidebar-widget">
            <h5 class="mb-3">
                <i class="fas fa-folder text-primary me-2"></i>
                –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
            </h5>
            <ul class="category-list">
                {% for category in categories %}
                <li>
                    <a href="{% url 'news:category_posts' category.slug %}">
                        {{ category.name }}
                        <span class="badge bg-secondary">{{ category.posts_count }}</span>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- –ü–û–ü–£–õ–Ø–†–ù–´–ï –¢–ï–ì–ò -->
        {% if popular_tags %}
        <div class="sidebar-widget">
            <h5 class="mb-3">
                <i class="fas fa-tags text-primary me-2"></i>
                –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏
            </h5>
            <div class="d-flex flex-wrap gap-1">
                {% for tag in popular_tags %}
                <a href="{% url 'news:tag_posts' tag.slug %}" class="badge bg-light text-dark text-decoration-none">
                    #{{ tag.name }}
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <div class="sidebar-widget">
            <h5 class="mb-3">
                <i class="fas fa-chart-bar text-primary me-2"></i>
                –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </h5>
            <div class="row text-center">
                <div class="col-6">
                    <div class="border-end">
                        <h4 class="text-primary mb-0">{{ total_posts }}</h4>
                        <small class="text-muted">–ù–æ–≤–æ—Å—Ç–µ–π</small>
                    </div>
                </div>
                <div class="col-6">
                    <h4 class="text-success mb-0">{{ total_views }}</h4>
                    <small class="text-muted">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</small>
                </div>
            </div>
        </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    AOS.init({
        duration: 600,
        easing: 'ease-out',
        once: true,
        offset: 50
    });

    // AJAX —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π
    document.addEventListener('DOMContentLoaded', function() {
        const filterTabs = document.querySelectorAll('.filter-tab');
        const newsContent = document.getElementById('news-content');
        const newsPagination = document.getElementById('news-pagination');

        let isLoading = false;

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º
        filterTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                if (isLoading) return;

                const filter = this.dataset.filter;

                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–±
                filterTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
                loadNewsContent(filter, 1);
            });
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('pagination-link')) {
                e.preventDefault();
                if (isLoading) return;

                const page = e.target.dataset.page;
                const filter = e.target.dataset.filter;

                loadNewsContent(filter, page);
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        function loadNewsContent(filter, page = 1) {
            if (isLoading) return;

            isLoading = true;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            newsContent.style.opacity = '0.5';
            newsPagination.style.opacity = '0.5';

            const url = new URL('{% url "news:filter_news_ajax" %}', window.location.origin);
            url.searchParams.set('filter', filter);
            url.searchParams.set('page', page);

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
                        newsContent.innerHTML = data.posts_html;
                        newsPagination.innerHTML = data.pagination_html;

                        // –ü–ª–∞–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
                        newsContent.style.opacity = '1';
                        newsPagination.style.opacity = '1';

                        // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º AOS –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                        AOS.refresh();

                        // –ú—è–≥–∫–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–∞—á–∞–ª—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–±–µ–∑ —Ä–µ–∑–∫–∏—Ö –¥–≤–∏–∂–µ–Ω–∏–π)
                        setTimeout(() => {
                            const filtersElement = document.querySelector('.news-filters');
                            const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
                            const filtersTop = filtersElement.offsetTop - 20; // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø

                            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–ª–µ–∫–æ –æ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤
                            if (Math.abs(currentScrollTop - filtersTop) > 100) {
                                window.scrollTo({
                                    top: filtersTop,
                                    behavior: 'smooth'
                                });
                            }
                        }, 150);
                    } else {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π:', data.error);
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
                })
                .finally(() => {
                    isLoading = false;
                });
        }
    });
</script>
{% endblock %}
