{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load humanize %}

{% block title %}–ú–æ–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ - –ì–∞–ª–µ—Ä–µ—è{% endblock %}

{% block extra_css %}
<!-- AOS Animation -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<!-- PhotoSwipe -->
<script type="module">
import PhotoSwipeLightbox from 'https://unpkg.com/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.js';
const lightbox = new PhotoSwipeLightbox({
  gallery: '.gallery-masonry',
  children: 'a',
  pswpModule: () => import('https://unpkg.com/photoswipe@5.4.4/dist/photoswipe.esm.js')
});
lightbox.init();
</script>
<!-- Masonry –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å–µ—Ç–∫–∏ -->
<script src="https://unpkg.com/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script>
<!-- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ hero-–∫–Ω–æ–ø–∫–∏ -->
    <link rel="stylesheet" href="{% static 'css/unified_hero_buttons.css' %}?v=20250609070">
<!-- CSS –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ -->
<link rel="stylesheet" href="{% static 'css/gallery_modern.css' %}?v=20250608110">
<!-- –ú–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ –¥–ª—è JavaScript -->
<meta name="user-authenticated" content="{% if user.is_authenticated %}true{% else %}false{% endif %}">
<meta name="csrf-token" content="{{ csrf_token }}">
<!-- –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–ô –°–ë–†–û–° –ö–ï–®–ê -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
{% endblock %}

{% block content %}
<div class="gallery-page">
    <div class="container">
        <!-- –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –ì–ï–†–û–ô –°–ï–ö–¶–ò–Ø –ö–ê–ö –í –ì–ê–õ–ï–†–ï–ï -->
        <div class="gallery-hero" data-aos="fade-up" data-aos-duration="500">
            <div class="container">
                <div class="hero-content text-center">
                    <h1 class="hero-title" data-aos="fade-up" data-aos-delay="100" data-aos-duration="500">üì∏ –ú–æ–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h1>
                    <p class="hero-subtitle" data-aos="fade-up" data-aos-delay="200" data-aos-duration="500">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π</p>

                    <div class="hero-stats-and-actions">
                        <div class="hero-stats">
                            <div class="stat-item" data-aos="zoom-in" data-aos-delay="400">
                                <span class="stat-number">{{ total_photos }}</span>
                                <span class="stat-label">–í—Å–µ–≥–æ —Ñ–æ—Ç–æ</span>
                            </div>
                            <div class="stat-item" data-aos="zoom-in" data-aos-delay="500">
                                <span class="stat-number">{{ total_public_photos }}</span>
                                <span class="stat-label">–ü—É–±–ª–∏—á–Ω—ã—Ö</span>
                            </div>
                            <div class="stat-item" data-aos="zoom-in" data-aos-delay="600">
                                <span class="stat-number">{{ total_private_photos }}</span>
                                <span class="stat-label">–ü—Ä–∏–≤–∞—Ç–Ω—ã—Ö</span>
                            </div>
                            <div class="stat-item" data-aos="zoom-in" data-aos-delay="700">
                                <span class="stat-number">{{ total_likes }}</span>
                                <span class="stat-label">–õ–∞–π–∫–æ–≤</span>
                            </div>
                        </div>

                        <div class="hero-actions">
                            <a href="{% url 'gallery:upload' %}" class="hero-btn" data-aos="fade-in" data-aos-delay="800">
                                <i class="fas fa-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
                            </a>
                            <a href="{% url 'gallery:gallery' %}" class="hero-btn-secondary" data-aos="fade-in" data-aos-delay="850">
                                <i class="fas fa-arrow-left me-2"></i>–í –≥–∞–ª–µ—Ä–µ—é
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –û–¢–î–ï–õ–¨–ù–´–ï –ö–û–ú–ü–ê–ö–¢–ù–´–ï –§–ò–õ–¨–¢–†–´ -->
        <div class="gallery-filters" data-aos="fade-up" data-aos-delay="300">
            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">
                    <i class="fas fa-images"></i>
                    –í—Å–µ –º–æ–∏ —Ñ–æ—Ç–æ
                </button>
                <button class="filter-tab" data-filter="public">
                    <i class="fas fa-eye"></i>
                    –ü—É–±–ª–∏—á–Ω—ã–µ
                </button>
                <button class="filter-tab" data-filter="private">
                    <i class="fas fa-eye-slash"></i>
                    –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ
                </button>
            </div>
        </div>

        {% if photos %}
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö -->
            <div class="results-info text-center mb-4" data-aos="fade-up">
                <span class="results-count">
                    –ü–æ–∫–∞–∑–∞–Ω–æ {{ photos|length }}
                    {% if is_paginated %}–∏–∑ {{ paginator.count }}{% endif %}
                    –≤–∞—à–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
                </span>
            </div>

            <!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –≥–∞–ª–µ—Ä–µ—è -->
            <div class="gallery-masonry">
                {% for photo in photos %}
                <div class="gallery-card" data-aos="fade-up" data-filter-type="{% if photo.is_public %}public{% else %}private{% endif %}">
                    <a href="{{ photo.image.url }}" data-pswp-width="{{ photo.image.width|default:800 }}" data-pswp-height="{{ photo.image.height|default:600 }}">
                        <div class="photo-container">
                            <img src="{{ photo.image.url }}" class="photo-image" alt="{{ photo.title|default:'–§–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏' }}">
                            {% if not photo.is_public %}
                            <div class="photo-badge private-badge">
                                <i class="fas fa-eye-slash"></i> –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ
                            </div>
                            {% endif %}
                            {% if photo.growlog %}
                            <div class="photo-badge growlog-badge">
                                <i class="fas fa-seedling"></i> –ì—Ä–æ—É-—Ä–µ–ø–æ—Ä—Ç
                            </div>
                            {% endif %}
                        </div>
                    </a>
                    <div class="card-info">
                        <div class="card-header">
                            <div class="author-info">
                                <img src="{{ photo.author.profile_extra.avatar.url|default:'/static/images/default_avatar.svg' }}"
                                     alt="{{ photo.author.display_name }}" class="author-avatar">
                                <div class="author-details">
                                    <span class="author-name">{{ photo.author.display_name }}</span>
                                    <div class="photo-date">{{ photo.created_at|date:"d.m.Y" }}</div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="photo-title">{{ photo.title|default:"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è" }}</h5>
                            {% if photo.description %}
                                <p class="photo-description">{{ photo.description }}</p>
                            {% endif %}
                        </div>
                        <div class="card-footer">
                            <div class="photo-stats">
                                <div class="stat-icon">
                                    <i class="fas fa-heart"></i>
                                    <span>{{ photo.likes.count }}</span>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-comment"></i>
                                    <span>{{ photo.comments.count }}</span>
                                </div>
                                {% if photo.growlog %}
                                <div class="stat-icon growlog-indicator">
                                    <i class="fas fa-seedling"></i>
                                    <span>–ì—Ä–æ—É</span>
                                </div>
                                {% endif %}
                            </div>
                            <div class="card-actions">
                                <a href="{% url 'gallery:photo_detail' photo.pk %}" class="action-btn view-btn me-2">
                                    <i class="fas fa-eye"></i>
                                    –°–º–æ—Ç—Ä–µ—Ç—å
                                </a>
                                <a href="{% url 'gallery:photo_edit' photo.pk %}" class="action-btn edit-btn me-2">
                                    <i class="fas fa-edit"></i>
                                    –ü—Ä–∞–≤–∏—Ç—å
                                </a>
                                <a href="{% url 'gallery:photo_delete' photo.pk %}" class="action-btn delete-btn">
                                    <i class="fas fa-trash"></i>
                                    –£–¥–∞–ª–∏—Ç—å
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            {% if is_paginated %}
            <nav aria-label="–ü–∞–≥–∏–Ω–∞—Ü–∏—è –º–æ–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π" data-aos="fade-up">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">–ü–µ—Ä–≤–∞—è</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
                        </li>
                    {% endif %}

                    {% for i in paginator.page_range %}
                        {% if page_obj.number == i %}
                            <li class="page-item active">
                                <span class="page-link">{{ i }}</span>
                            </li>
                        {% elif i > page_obj.number|add:'-3' and i < page_obj.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ i }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">{{ i }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">–°–ª–µ–¥—É—é—â–∞—è</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ paginator.num_pages }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">–ü–æ—Å–ª–µ–¥–Ω—è—è</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        {% else %}
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π -->
            <div class="empty-state text-center" data-aos="fade-up">
                <div class="empty-icon">
                    <i class="fas fa-camera fa-4x text-muted mb-4"></i>
                </div>
                <h3 class="text-muted">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h3>
                <p class="text-muted mb-4">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –µ—é —Å —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º!</p>
                <a href="{% url 'gallery:upload' %}" class="hero-btn">
                    <i class="fas fa-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ
                </a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- AOS Animation -->
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<!-- PhotoSwipe -->
<script type="module">
import PhotoSwipeLightbox from 'https://unpkg.com/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.js';
const lightbox = new PhotoSwipeLightbox({
  gallery: '#my-photos-gallery',
  children: 'a',
  pswpModule: () => import('https://unpkg.com/photoswipe@5.4.4/dist/photoswipe.esm.js')
});
lightbox.init();
</script>
<!-- Masonry –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å–µ—Ç–∫–∏ -->
<script src="https://unpkg.com/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script>
<!-- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -->
<script src="{% static 'js/gallery_modern.js' %}?v=20250608050"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AOS
    AOS.init({
        duration: 800,
        easing: 'ease-in-out',
        once: true,
        offset: 50
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Masonry
    const grid = document.querySelector('.gallery-masonry');
    if (grid) {
        const masonry = new Masonry(grid, {
            itemSelector: '.gallery-card',
            columnWidth: '.gallery-card',
            gutter: 20,
            percentPosition: true
        });

        // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        setTimeout(() => {
            masonry.layout();
        }, 500);
    }

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    const filterTabs = document.querySelectorAll('.filter-tab');
    const galleryCards = document.querySelectorAll('.gallery-card');

    filterTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —Ç–∞–±–æ–≤
            filterTabs.forEach(t => t.classList.remove('active'));
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞ —Ç–µ–∫—É—â–∏–π —Ç–∞–±
            this.classList.add('active');

            const filter = this.getAttribute('data-filter');

            galleryCards.forEach(card => {
                if (filter === 'all') {
                    card.style.display = 'block';
                } else {
                    const cardType = card.getAttribute('data-filter-type');
                    if (cardType === filter) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                }
            });

            // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Masonry –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            if (grid && masonry) {
                setTimeout(() => {
                    masonry.layout();
                }, 100);
            }
        });
    });
});
</script>
{% endblock %}
