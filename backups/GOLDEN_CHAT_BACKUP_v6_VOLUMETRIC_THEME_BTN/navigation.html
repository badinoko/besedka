{% load static i18n %}
{% load core_tags %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top shadow-sm">
    <div class="container-fluid px-3 px-lg-4">
        <a class="navbar-brand fw-bold" href="{% url 'home' %}">
            <i class="fas fa-home"></i> –ë–µ—Å–µ–¥–∫–∞
        </a>

        <!-- –°–¢–ê–¢–£–° –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –û–¢–î–ï–õ–¨–ù–û –°–ü–†–ê–í–ê –û–¢ –õ–û–ì–û–¢–ò–ü–ê -->
        {% if request.resolver_match.url_name == 'room' or request.resolver_match.url_name == 'chat_test' %}
        <span id="connection-status" class="connection-status-nav status-connecting ms-2">
            <i class="fas fa-lock"></i>
        </span>
        {% endif %}

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavGlobal">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavGlobal">
            <!-- –õ–ï–í–ê–Ø –°–ï–ö–¶–ò–Ø: –û–°–ù–û–í–ù–´–ï –°–°–´–õ–ö–ò (—Å–∫—Ä—ã—Ç—ã –≤ —á–∞—Ç–µ) -->
            {% if request.resolver_match.url_name != 'room' and request.resolver_match.url_name != 'chat_test' %}
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'news:home' %}">
                        <i class="fas fa-newspaper"></i> –ù–æ–≤–æ—Å—Ç–∏
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'store:catalog' %}">
                        <i class="fas fa-store"></i> {% trans "–ú–∞–≥–∞–∑–∏–Ω" %}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'growlogs:list' %}">
                        <i class="fas fa-seedling"></i> –ì—Ä–æ—É—Ä–µ–ø–æ—Ä—Ç—ã
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'gallery:gallery' %}">
                        <i class="fas fa-images"></i> –ì–∞–ª–µ—Ä–µ—è
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'chat:room' 'general' %}">
                        <i class="fas fa-comments"></i> {% trans "–ß–∞—Ç" %}
                    </a>
                </li>
            </ul>
            {% endif %}

            <!-- –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –°–ï–ö–¶–ò–Ø: –ù–ê–ó–í–ê–ù–ò–ï –ß–ê–¢–ê (—Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö —á–∞—Ç–∞) -->
            {% if request.resolver_match.url_name == 'room' or request.resolver_match.url_name == 'chat_test' %}
            <div class="d-flex justify-content-center flex-grow-1">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle current-channel-nav
                           {% if request.resolver_match.kwargs.room_name == 'vip' %}channel-vip{% else %}channel-general{% endif %}"
                           href="#" id="channelDropdownNav" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-{% if request.resolver_match.kwargs.room_name == 'vip' %}crown{% else %}comments{% endif %} me-1"></i>
                            <span id="currentChannelName">
                                {% if request.resolver_match.kwargs.room_name == 'general' %}
                                    –ë–µ—Å–µ–¥–∫–∞
                                {% elif request.resolver_match.kwargs.room_name == 'vip' %}
                                    –ë–µ—Å–µ–¥–∫–∞ - VIP
                                {% else %}
                                    –ß–∞—Ç
                                {% endif %}
                            </span>
                        </a>
                        <ul class="dropdown-menu shadow" aria-labelledby="channelDropdownNav">
                            <li><a class="dropdown-item channel-option-general" href="{% url 'chat:room' 'general' %}">
                                <span class="text-success">‚¨§</span> –ë–µ—Å–µ–¥–∫–∞
                            </a></li>
                            {% load chat_extras %}
                            {% can_access_vip_chat request.user as vip_access %}
                            {% if vip_access %}
                            <li><a class="dropdown-item channel-option-vip" href="{% url 'chat:room' 'vip' %}">
                                <span class="text-warning">‚¨§</span> –ë–µ—Å–µ–¥–∫–∞ - VIP
                            </a></li>
                            {% endif %}
                        </ul>
                    </li>
                </ul>
            </div>
            {% endif %}
            <ul class="navbar-nav ms-auto align-items-center">
                <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã - –æ–±—ä–µ–º–Ω–∞—è –∫–∞–∫ –∑–Ω–∞—á–æ–∫ —Å—Ç–∞—Ç—É—Å–∞ -->
                <li class="nav-item">
                    <button class="nav-link btn border-0 bg-transparent theme-toggle-btn theme-toggle-3d"
                            onclick="toggleTheme()"
                            title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"
                            style="
                                /* üé® –û–ë–™–ï–ú–ù–´–ô –î–ò–ó–ê–ô–ù –í –°–¢–ò–õ–ï –õ–ê–ô–ö-–ö–ù–û–ü–ö–ò (–°–ò–ù–Ø–Ø –í–ï–†–°–ò–Ø) */
                                width: 50px;
                                height: 50px;
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                margin: 0 0.5rem;

                                /* –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω */
                                background: linear-gradient(135deg, #007bff 0%, #0056b3 50%, #004494 100%);
                                border: 3px solid #007bff !important;

                                /* 3D-—Ç–µ–Ω–∏ –≤ —Å—Ç–∏–ª–µ –ª–∞–π–∫-–∫–Ω–æ–ø–∫–∏ */
                                box-shadow:
                                    0 15px 35px rgba(0, 123, 255, 0.45),
                                    0 8px 20px rgba(0, 123, 255, 0.35),
                                    0 4px 8px rgba(0, 0, 0, 0.25),
                                    inset 0 2px 0 rgba(255, 255, 255, 0.3);

                                /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ */
                                transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
                            ">
                        <i class="fas fa-moon theme-icon" style="color: #ffffff !important; font-size: 1.2rem;"></i>
                    </button>
                </li>
                <li class="nav-item d-flex align-items-center">
                    <a class="nav-link nav-link-with-counter d-flex align-items-center" href="{% url 'store:cart_detail' %}" style="margin: 0 0.5rem;">
                        <i class="fas fa-shopping-cart nav-icon"></i>
                        <span class="nav-counter-badge cart-badge rounded-pill" style="{% if cart_items_count == 0 %}display: none;{% else %}display: flex;{% endif %}">
                            {{ cart_items_count|default:0 }}
                            <span class="visually-hidden">—Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ</span>
                        </span>
                    </a>
                </li>
                <li class="nav-item d-flex align-items-center" style="margin: 0 0.5rem;">
                    {% user_info_badge %}
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- üé® –°–¢–ò–õ–ò –î–õ–Ø –û–ë–™–ï–ú–ù–û–ô –ö–ù–û–ü–ö–ò –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –¢–ï–ú -->
<style>
/* Hover-—ç—Ñ—Ñ–µ–∫—Ç—ã –≤ —Å—Ç–∏–ª–µ –ª–∞–π–∫-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º */
.theme-toggle-3d:hover {
    /* –£—Å–∏–ª–µ–Ω–Ω—ã–µ 3D-—Ç–µ–Ω–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    box-shadow:
        0 20px 45px rgba(0, 123, 255, 0.55) !important,
        0 12px 25px rgba(0, 123, 255, 0.45) !important,
        0 6px 12px rgba(0, 0, 0, 0.35) !important,
        inset 0 2px 0 rgba(255, 255, 255, 0.4) !important;

    /* –õ–µ–≥–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ */
    transform: scale(1.05);
}

/* –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è */
.theme-toggle-3d:active {
    transform: scale(0.95);
    box-shadow:
        0 8px 20px rgba(0, 123, 255, 0.4) !important,
        0 4px 10px rgba(0, 123, 255, 0.3) !important,
        0 2px 4px rgba(0, 0, 0, 0.2) !important,
        inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
}

/* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–∞–≤–æ–π —Å–µ–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
.navbar-nav.ms-auto li.nav-item {
    display: flex;
    align-items: center;
    height: 60px; /* –í—ã—Å–æ—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
}

.nav-link-with-counter {
    height: auto !important;
    min-height: auto !important;
}
</style>

{# {% include 'includes/chat_modal.html' %} #}
